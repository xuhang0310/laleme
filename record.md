# 排便记录功能数据规范与应用指南

本文档详细描述了 `add.vue` 页面产生的数据结构、各字段含义，以及如何在 `report.vue` 中利用这些数据进行健康分析与可视化展示。

## 1. 数据结构 (Data Model)

排便记录存储在本地缓存 `uni.getStorageSync('poop_records')` 中，为一个对象数组。单个记录 (`Record`) 的结构如下：

```json
{
  "timestamp": 1707567890123,   // 唯一标识 (时间戳，Number)
  "date": "2024/2/10",          // 日期字符串 (String)
  "time": "08:30",              // 时间字符串 (String, HH:mm)
  "type": "poop",               // 记录类型: 'poop' (顺利排便) | 'no_poop' (没拉出来)
  "relation": "本人",            // 记录对象 (String, 目前固定为"本人")
  
  // 以下字段仅在 type === 'poop' 时有效，否则为 "无"
  "shape": "香蕉状",             // 形状 (String: '香蕉状'|'羊粪球'|'糊状'|'水状'|'硬条状'|'无')
  "color": "黄色",               // 颜色 (String: '棕色'|'黄色'|'绿色'|'黑色'|'红色'|'无')
  "amount": "适中",              // 分量 (String: '少'|'适中'|'多'|'无')
  
  "symptoms": ["带血", "腹痛"],   // 异常症状 (Array<String>: ['带血'|'粘液'|'未消化'|'恶臭'|'排便不尽'|'腹痛'])
  
  "feeling": "顺畅",             // 排便感受 (String: '迅速'|'顺畅'|'费力'|'困难'|'自定义')
  "duration": "5-15 min",       // 耗时描述 (String)
  "note": "昨晚吃了火锅"          // 备注 (String)
}
```

## 2. 字段详细含义与健康隐喻

### 2.1 核心字段
| 字段 | 类型 | 描述 | 健康含义 |
| :--- | :--- | :--- | :--- |
| **type** | Enum | `poop` / `no_poop` | `no_poop` 表示便秘或排便意愿未满足，连续出现应警惕肠道功能紊乱。 |
| **shape** | Enum | 对应布里斯托大便分类法 | **香蕉状/硬条状**: 正常<br>**羊粪球**: 便秘 (缺水/纤维)<br>**糊状/水状**: 腹泻 (炎症/消化不良) |
| **color** | Enum | 大便颜色 | **棕/黄**: 正常<br>**红/黑**: **危险** (可能消化道出血)<br>**绿**: 消化过快或饮食影响<br>**陶土色(未列出但需注意)**: 肝胆问题 |
| **symptoms**| Array| 多选标签 | **带血/粘液/腹痛**: **高危信号**，建议就医<br>**未消化**: 咀嚼不足或消化酶缺乏 |

## 3. Report.vue 应用建议

基于上述新数据结构，`report.vue` 可以进行多维度的深度分析：

### 3.1 基础统计 (已部分实现)
- **如厕频率 (Frequency)**: 统计本周总次数。
  - *升级建议*: 区分 `poop` 和 `no_poop`。如果一周有 3 次 `no_poop`，应给予“便秘预警”。

### 3.2 形状趋势图 (Shape Trend)
- **可视化**: 饼图或进度条。
- **逻辑**: 统计 `shape` 字段的分布。
- **文案**: 
  - 优: "本周 80% 为香蕉状，肠道状态完美！"
  - 差: "本周 50% 为羊粪球，建议多喝水、补充膳食纤维。"

### 3.3 异常预警卡片 (Health Alert) - **新功能**
- **逻辑**: 遍历本周记录的 `symptoms` 和 `color`。
- **触发条件**: 
  - `symptoms` 包含 "带血" 或 "粘液"。
  - `color` 为 "红色" 或 "黑色"。
- **展示**: 在报告顶部显示红色警示卡片：“检测到本周有 2 次大便带血记录，请密切关注或咨询医生。”

### 3.4 规律性分析 (Regularity)
- **逻辑**: 分析 `time` 字段的分布。
- **展示**: "您的排便生物钟" 图表。
- **洞察**: "您通常在 **08:00 - 09:00** 排便，保持得很规律！" 或 "您的排便时间极不规律，建议养成定时习惯。"

### 3.5 痛苦指数 (Pain Index)
- **逻辑**: 将 `feeling` 转化为分数 (`迅速`=5, `顺畅`=4, `费力`=2, `困难`=1)。
- **展示**: 折线图展示“顺畅度”变化。
- **关联**: 如果“痛苦指数”高且 `type` 为 `no_poop`，则为严重便秘。

### 3.6 高级健康洞察 (Advanced Health Insights)
- **肠道年龄评估**: 结合 `shape`、`color`、`symptoms`、`frequency` 等多维度数据，通过预设的健康评分模型，评估用户的肠道健康年龄。例如，长期羊粪球状、排便费力、有腹痛症状的用户，其肠道年龄可能高于实际年龄。
- **饮食关联分析**: 如果用户在备注 `note` 中记录了饮食信息（如“昨晚吃了火锅”），并结合后续的排便记录（如“糊状”、“腹痛”），可以尝试建立饮食与排便异常的潜在关联，提供个性化饮食建议。
- **周期性分析**: 对于女性用户，可以结合生理周期数据（如果应用有集成）分析排便习惯在不同生理阶段的变化。

### 3.7 智能算法建议 (Algorithmic Advice)
- **个性化干预建议**:
    - **便秘倾向**: 如果连续多日 `type` 为 `no_poop` 或 `shape` 多为“羊粪球”，建议“增加饮水量，多摄入膳食纤维，尝试规律运动”。
    - **腹泻倾向**: 如果 `shape` 多为“糊状”或“水状”，建议“注意饮食卫生，避免生冷辛辣食物，必要时就医”。
    - **异常症状**: 对于“带血”、“粘液”等高危症状，除了警示，还可以提供“建议咨询消化科医生，进行肠镜检查”等具体行动指南。
- **习惯养成提醒**: 根据规律性分析结果，如果用户排便时间不规律，可以推送“建议每天固定时间尝试排便，培养生物钟”的提醒。
- **情绪与肠道关联**: 如果用户频繁记录“腹痛”且无明显生理原因，可以结合心理健康模块（如果存在）提供“关注情绪压力，尝试放松练习”的建议，提示肠脑轴的潜在影响。