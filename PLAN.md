# Laleme 小程序深度执行方案 - 行为资产化互动系统

## 1. 核心设计理念：行为资产化
借鉴“支付宝蚂蚁森林/养鸡”模式，将用户的工具行为（记录健康数据）转化为情感资产（小狗的成长与互动），通过“记录 -> 奖励 -> 互动 -> 情感维系”的闭环，提升用户粘性和使用乐趣。

## 2. 交互体验升级 (让小狗“活”起来)
在不引入重型 3D 引擎的前提下，通过 CSS 动画和物理反馈赋予小狗生命力。

### 2.1 视觉动效 (Visual)
- **呼吸感 (Idle State)**:
  - 状态：小狗处于静止时。
  - 效果：通过 CSS3 `transform: scale` 和 `translateY` 组合动画，模拟小狗胸腔起伏和身体微微浮动的呼吸节奏。
- **手指跟随 (Eye Tracking)**:
  - 状态：用户手指在屏幕滑动时。
  - 效果：监听 `touchmove` 事件，计算手指相对小狗的位置，让小狗产生微小的位移或旋转（视差效果），仿佛在注视着用户的手指。
- **进食动效 (Eating)**:
  - 状态：投喂狗粮时。
  - 效果：
    1. 抛物线动画：狗粮图标从底部飞入小狗嘴边。
    2. 咀嚼反馈：小狗进行快速的“挤压-回弹”循环动画，模拟咀嚼动作。
    3. 满足表现：冒出爱心气泡，并伴随快乐的跳跃。
- **抚摸反馈 (Petting)**:
  - 状态：用户点击/抚摸小狗时。
  - 效果：小狗瞬间受到挤压变形 (Squash & Stretch)，配合 `uni.vibrateShort()` 触觉反馈，模拟 Q 弹的肉感。
- **情绪状态机 (Emotion)**:
  - **Normal**: 平稳呼吸。
  - **Happy**: 快速跳动 + 撒花特效（喂食/抚摸后）。
  - **Hungry**: 动作迟缓 + 灰度滤镜（长时间未互动）。

### 2.2 触觉反馈 (Haptic)
- 利用 `uni.vibrateShort()` 配合点击动画，提供真实的物理触感，强化“抚摸”的真实性。

## 3. 游戏化经济系统 (Game Loop)

### 3.1 核心资源：狗粮 (Dog Food) 🦴
狗粮是连接“用户行为”和“小狗成长”的唯一货币。

### 3.2 获取路径 (Input - 激励行为)
| 行为 | 奖励值 | 设计目的 |
| :--- | :--- | :--- |
| **每日签到** | +10g | 培养每日打开习惯 |
| **记录便便** | +50g | 核心业务激励，通过高额奖励鼓励记录 |
| **完美记录** | 额外 +20g | 引导用户关注健康（布里斯托 3/4 型为健康） |

### 3.3 消耗路径 (Output - 情感消费)
| 行为 | 消耗值 | 效果反馈 |
| :--- | :--- | :--- |
| **喂食** | -20g | 增加饱食度，触发“进食”动画，增加亲密度 |
| **陪玩/聊天** | -10g | 增加心情值，触发特殊对话气泡 |

### 3.4 成长体系 (Progression)
- **亲密度等级**: 累计亲密度升级。
- **解锁内容**:
  - Lv.1 -> Lv.2: 解锁“小狗墨镜”皮肤。
  - Lv.2 -> Lv.3: 解锁“AI 智能对话”功能（小狗能根据你的健康状况给建议）。

## 5. 互动系统详解 (Chat System) - 页面核心功能规划

Chat 页面不再仅仅是一个聊天窗口，而是一个“互动庄园”。三个核心按钮将行为与数据紧密联动。

### 5.1 领狗粮 (Task Center)
**入口**：底部左侧按钮
**交互逻辑**：
1.  **点击触发**：从底部滑出半屏弹窗 (ActionSheet 风格)。
2.  **内容展示**：
    *   **当前资产**：显示当前剩余狗粮数量 (e.g., 120g)。
    *   **任务列表**：
        *   `每日签到`：状态 (已领取/未领取)。点击“签到”按钮，播放金币落袋音效，按钮变灰。
        *   `记录便便`：状态 (0/1)。点击“去完成”，跳转至 `add.vue` 页面。
        *   `查看报告`：状态 (0/1)。点击“去查看”，跳转至 `report.vue` 页面。
3.  **反馈**：领取成功时，顶部弹出 Toast "+10g"，并触发数字滚动动画。

### 5.2 喂食 (Feed Interaction)
**入口**：底部中间大按钮 (Main Action)
**交互逻辑**：
1.  **前置校验**：检查本地存储中的狗粮余额。
2.  **分支处理**：
    *   **余额充足 (>= 20g)**：
        *   **扣除资源**：余额 -20g。
        *   **播放动画**：
            1.  生成一个狗粮 Icon，沿贝塞尔曲线从按钮位置飞向小狗嘴边。
            2.  小狗触发 `Eating` 状态（咀嚼动画）。
            3.  头顶冒出爱心气泡，亲密度进度条上涨。
        *   **震动反馈**：`uni.vibrateShort()`。
    *   **余额不足 (< 20g)**：
        *   **小狗反馈**：触发 `Sad` 表情（垂头丧气/摇尾巴停止）。
        *   **系统提示**：弹出模态框“粮仓空了！快去完成任务赚狗粮吧~”，引导点击“领狗粮”。

### 5.3 聊天 (Chat Mode)
**入口**：底部右侧按钮
**交互逻辑**：
1.  **模式切换**：
    *   点击后，底部操作栏下沉消失。
    *   页面背景保持不变（或轻微虚化）。
    *   从底部升起一个全屏/半屏的聊天界面层 (Chat Overlay)。
2.  **功能定义**：
    *   **基础对话**：用户输入文字/表情，小狗基于关键词库回复（如输入“便秘”，回复“多喝水哦”）。
    *   **健康关怀 (Context Aware)**：
        *   系统检测到用户最近 3 天未记录 -> 主动询问“主人这两天身体还好吗？”
        *   系统检测到连续记录“腹泻” -> 主动推送“要注意饮食卫生呀，需要我帮你记一下吃了什么吗？”
3.  **退出**：点击顶部收起按钮，恢复到“庄园模式”。

## 6. 技术执行架构 (Technical Implementation)

### 6.1 数据模型 (Data Schema)
采用本地存储 (`uni.setStorage`) 优先策略，确保隐私和极速体验。

```javascript
// 核心状态管理 (Store)
interface PetState {
  // 基础属性
  name: string;
  level: number;      // 等级
  exp: number;        // 当前经验/亲密度
  food: number;       // 剩余狗粮 (g)
  
  // 状态属性 (0-100)
  hunger: number;     // 饥饿度 (随时间衰减)
  happiness: number;  // 快乐值 (随时间衰减)
  
  // 系统属性
  lastLoginDate: string; // 签到判断
  lastInteraction: number; // 上次互动时间戳
}
```

### 6.2 核心模块开发规划

#### 阶段一：注入灵魂 (已完成)
- [x] 实现首页小狗的 CSS "呼吸" 动画。
- [x] 绑定点击事件，实现“抚摸震动”与 Q 弹反馈。
- [x] 手指跟随视差效果。
- [x] 沉浸式庄园场景搭建。

#### 阶段二：建立账本 (当前重点)
- [ ] **Store 封装**: 创建 `usePetStore`，实现数据的读取与持久化。
- [ ] **领狗粮功能**: 实现任务弹窗 UI 及“签到/跳转”逻辑。
- [ ] **喂食闭环**: 连通“喂食”按钮 -> 扣除狗粮 -> 播放抛物线动画 -> 更新 UI。

#### 阶段三：深度互动
- [ ] **聊天界面**: 开发覆盖式聊天窗口 UI。
- [ ] **业务联动**: 改造“记录便便”流程，保存成功后弹出“获得 50g 狗粮”奖励提示。
- [ ] **自动签到**: 实现每日首次打开自动检测签到逻辑。

## 7. 未来扩展 (Future)
- **云端同步**: 接入 uniCloud，防止数据丢失。
- **AI 对话**: 接入大模型，让小狗根据用户的排便历史，给出专业的健康建议。
