# Report Page Upgrade Plan (report.vue)

基于 `record.md` 定义的新数据结构，本计划旨在指导 `report.vue` 的逻辑升级，以提供更深入的健康洞察。

## 1. 核心目标
保持现有 UI 结构（卡片式布局、配色风格）不变，通过增强数据处理逻辑，展示以下新维度：
- **便秘追踪**: 区分有效排便 (`poop`) 与无效排便 (`no_poop`)。
- **危险预警**: 针对“带血”、“红/黑便”的高危信号进行强提醒。
- **智能建议**: 根据形状和症状提供具体的健康小贴士。

## 2. 数据处理逻辑升级 (Data Processing)

### 2.1 预处理与兼容性
- **任务**: 读取 `poop_records` 时，需兼容旧数据（无 `type` 字段默认为 `poop`，无 `symptoms` 默认为空数组）。

### 2.2 核心算法模块

#### A. 频率与成功率分析 (Frequency & Success)
- **现有**: 仅统计总次数。
- **升级**:
    - 计算 **总尝试次数** (Total Attempts)
    - 计算 **排便成功率** (Success Rate = `poop` count / total count)
    - 如果本周有 >3 次 `no_poop`，标记为“便秘风险”。

#### B. 异常症状扫描 (Symptom Scanner)
- **逻辑**: 遍历本周记录，寻找以下“红色警报”：
    - `color` 为 '红色' 或 '黑色'
    - `symptoms` 包含 '带血' 或 '粘液'
- **输出**: 一个 `Alert` 对象，包含警报级别 (High/Medium) 和提示文案。

#### C. 形状健康度 (Shape Health)
- **逻辑**: 统计 `poop` 类型记录的形状分布。
    - **完美**: 香蕉状 + 适中
    - **干硬**: 羊粪球 + 硬条状
    - **稀窜**: 水状 + 糊状
- **输出**: 主导形状 (Dominant Shape) 和对应的健康文案。

#### D. 智能小贴士生成 (Smart Tips)
- **逻辑**: 基于 `record.md` 中的决策表，生成每日建议。
    - 优先级规则: 危险信号 > 便秘/腹泻 > 饮食建议 > 心理/放松。

## 3. UI 适配计划 (UI Adaptation)

### 3.1 顶部区域: 健康警报 (New)
- **位置**: 在 `Frequency Card` 上方。
- **组件**: 新增一个可关闭的 `AlertBanner`。
- **样式**: 红色背景/文字，醒目展示（仅在触发 B 类逻辑时显示）。

### 3.2 频率卡片 (Frequency Card)
- **改动**:
    - 将 "本周" badge 改为展示 "成功率 XX%" (如果存在 `no_poop` 记录)。
    - 柱状图颜色区分: `poop` 用绿色，`no_poop` 用灰色或黄色叠加。

### 3.3 感觉/洞察卡片 (Middle Row)
- **Feeling Card**: 保持圆环图，但数据源改为“无痛排便率” (即 `feeling` != '困难'/'费力')。
- **Insight Card**:
    - 第一行: 展示“主导形状” (如 "80% 香蕉状").
    - 第二行: 展示“异常标签” (如 "2次 腹痛").
    - Footer: 展示生成的“智能小贴士” (Smart Tip).

## 4. 实施步骤 (Action Items)

1.  **数据层重构**: 在 `report.vue` 中编写 `processAlerts`, `processSuccessRate`, `processSmartTips` 等纯函数。
2.  **Mock 数据测试**: 构造包含“便秘”、“带血”等极端情况的测试数据，验证算法准确性。
3.  **UI 绑定**: 将计算结果绑定到视图，微调样式以适应不同长度的文案。
4.  **回归测试**: 确保旧数据（只有 timestamp 和 note）不会导致页面崩溃。

## 5. 宠物互动增强计划 (Pet Interaction Enhancement)

基于“主人健康 = 宠物快乐”的情感连接，将 Milestone Card 升级为互动核心。

### 5.1 情绪共鸣系统 (Emotional Resonance)
- **机制**: 狗狗的表情/状态与 **本周健康评分** 绑定。
    - **开心 (Happy)**: 成功率 > 80% 且无红色警报 -> 展示 `puppy_happy.png` (狗狗开心笑/比心)。
    - **担忧 (Worried)**: 出现红色警报 (带血/黑便) -> 展示 `puppy_worry.png` (狗狗眉头紧锁/急救箱)。
    - **鼓励 (Encouraging)**: 出现便秘 (`no_poop`) -> 展示 `puppy_cheer.png` (狗狗递水/加油手势)。
- **UI 实现**: 仅使用静态图片切换 (`<image src="...">`)，暂不引入复杂动画。确保图片风格统一（如统一为卡通插画风）。

### 5.2 场景化对话 (Contextual Dialogue)
不再使用固定文案，而是根据 `Smart Tips` 生成狗狗的“碎碎念”：
- **便秘时**: "主人是不是肚子不舒服？我给你揉揉~ (递水)"
- **健康时**: "哇！今天的便便形状真完美！奖励你一个贴贴！"
- **深夜记录时**: "这么晚才拉？要注意休息哦，熬夜对肠胃不好。"